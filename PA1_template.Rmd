---
title: "Reproducible Research: Peer Assessment 1"
author: "JCFrench"
date: "4/6/2015"
output: html_document
---
## Introduction
This document contains a series of five chunks of R code which provide an analysis of user step activity recorded over time.

1. Data Loading and Preprocessing
2. Exploratory analysis of mean and median steps per day
3. Exploratory analysis of daily activity patterns
4. Data Correction to impute missing step values
5. Exploratory analysis of workday activity patterns vs. weekend activity patterns

### Required R Packages
- dplyr 0.4.1
- ggplot2 1.0.1
- lubridate 1.3.3

```{r}
library(dplyr)
library(ggplot2)
library(lubridate)
```

## Loading and preprocessing the data
1. Set the working directory path
2. Download the compressed activity data
3. Decompress the data
4. Load the data into a dplyr tbl_df
5. Sumarize the raw data

Based on the summary, we can see that there are 3 fields in this data set; steps, date, interval. These fields are described in the course assignment.  

On cursory review, 2304 records (13%) are missing steps (NA). 

```{r}
setwd("~/data/RepData/RepData_PeerAssessment1")
unzip("activity.zip")
activity <- tbl_df(read.csv("activity.csv"))
summary(activity)

```

## What is mean total number of steps taken per day?
Here, we use the dplyr package to quickly group activities by date, and then tally the steps per day. The "step per day" calculation is acheived via a dplyr pipeline construct: group activity records by date, summarise steps via sum, ignoring "NA" values.  

Next, plot the sum of steps per day in a historgram.  

Lastly, calculate the mean steps per day, and the median steps per day.  

```{r}

stepperday <- activity %>% group_by(date) %>% summarise(stepsum = sum(steps, na.rm = TRUE))

qplot(date, data=stepperday, weight=stepsum, geom="histogram") + 
        scale_x_discrete(
                breaks=stepperday$date[seq(1,dim(stepperday)[1],by=10)])

summary(stepperday)

```

## What is the average daily activity pattern?


```{r}
###ggplot(data=activity) + geom_line(aes(interval, steps, group = date, color = date)) + 
  
###ggplot(data=activity) + geom_line(aes(interval, mean(steps, na.rm=T), group = interval))

meanpattern <- activity %>% group_by(interval) %>% 
                          summarise(stepmean = mean(steps, na.rm = TRUE))

qplot(interval, stepmean, data=meanpattern, geom=c("line","smooth"))

maxpattern <- meanpattern %>% filter(stepmean == max(meanpattern$stepmean))
maxpattern

```

## Imputing missing values
```{r}
naactivity <- activity %>% filter(is.na(steps))
impactivity <- inner_join(naactivity,meanpattern,by=c("interval" = "interval"))

### impute missing values as the average observed steps within the interval
imputedactivity <- activity %>% 
                   group_by(interval) %>%
                   mutate(steps= replace(steps, is.na(steps), mean(steps, na.rm=TRUE)))
                   
imputedstepperday <- imputedactivity %>% group_by(date) %>% summarise(stepsum = sum(steps, na.rm = TRUE))

### explore the imputed results
qplot(date, data=imputedstepperday, weight=stepsum, geom="histogram") + 
        scale_x_discrete(
                breaks=imputedstepperday$date[seq(1,dim(imputedstepperday)[1],by=10)])

summary(imputedstepperday)

```
## Are there differences in activity patterns between weekdays and weekends?

By filtering the imputed activity into weekend vs. weekday subsets, we can see that activity across a weekend day is generally higher then the activity across a working week day.  

According the lubridate package functionality, Sundays are coded as "wday == 1"", while Saturdays are coded as "wday == 7".  

Split the imputed activities, seperating weekend days from work week days.  

Next, create daily average activity patterns for work days vs. weekends.  

Finally, provide a comparison plot.

```{r}
weekendactivity <- imputedactivity %>% 
  mutate(weekend = 
           ifelse(
             wday(ymd(date)) %in% c(1,7),
             "Weekend",
             "Weekday")
         )

weekendpattern <- weekendactivity %>% 
  group_by(weekend,interval) %>% 
  summarise(stepmean = mean(steps))

summary(weekendpattern)

ggplot(weekendpattern, aes(interval,stepmean)) +
  geom_line(color="blue") +
  stat_smooth(color="purple") +
  facet_wrap(~weekend,nrow=2)

```

## Summary
The exploratory analysis of the activity data set determined the following interesting facts:

1. The source data was missing step counts for roughly 13% of recorded observations.

2. On average, 9354 steps were taken per day, with a median of 10395 steps per day.

3. The average daily pattern of steps has an early spike of activity at the 835 time interval.

4. Imputing missing values shifts the mean and median to 10766

5. Weekday daily activity patterns were compared to workday daily activity patterns. Weekend patterns show a higher level of activity spread across the entire day, whereas the weekday  pattern is similar to the average daily pattern presented in section 3.   

The weekday daily activity pattern is distinct from the weekend daily activity pattern.

